import{_ as I,o as i,c as l,a as g,t as x,n as D,F as P,f as L,g as T,r as U,b as _,w as j}from"./index.9f97e645.js";const B={props:["users","startDrag","onDrop","groupName","desc","descColor"]},F={class:"userList"},M={class:"list"},z=["onDragstart"];function G(s,t,a,h,u,r){return i(),l("div",F,[g("div",{class:"desc",style:D({background:a.descColor})},[g("div",null,x(a.desc),1)],4),g("div",M,[(i(!0),l(P,null,L(a.users,o=>(i(),l("div",{class:"user-object",key:o},[g("div",{class:"user",style:D({color:o.color,border:`5px solid ${o.groupColor}`}),draggable:"true",onDragstart:c=>a.startDrag(c,o)},x(o.nick),45,z)]))),128))])])}var E=I(B,[["render",G]]);const J={props:["tiers","groups","startDrag","onDrop"],data(){return{colors:["rgb(59, 59, 59)","rgb(80 80 80)","rgb(59, 59, 59)","rgb(80 80 80)","rgb(59, 59, 59)"]}}},V={class:"tierlist"},$=["onDrop"],q=["onDragstart"];function K(s,t,a,h,u,r){return i(),l("div",V,[(i(!0),l(P,null,L(a.tiers,(o,c)=>(i(),l("table",{class:"tierlist-block",key:o},[g("tr",null,[g("th",{class:"tierlist-class",style:D({background:o.color})},x(o.name),5),g("th",{class:"tierlist-element",style:D({background:u.colors[c]}),onDrop:n=>a.onDrop(n,o.name),onDragover:t[0]||(t[0]=T(()=>{},["prevent"])),onDragenter:t[1]||(t[1]=T(()=>{},["prevent"]))},[(i(!0),l(P,null,L(a.groups[o.name],n=>(i(),l("div",{class:"user-object",key:n},[g("div",{class:"user",style:D({color:n.color,border:`5px solid ${n.groupColor}`}),draggable:"true",onDragstart:e=>a.startDrag(e,n)},x(n.nick),45,q)]))),128))],44,$)])]))),128))])}var Q=I(J,[["render",K]]);const W={computed:{groups(){return{A:this.Users.filter(s=>s.group==="A"),B:this.Users.filter(s=>s.group==="B"),C:this.Users.filter(s=>s.group==="C"),D:this.Users.filter(s=>s.group==="D"),F:this.Users.filter(s=>s.group==="F"),mods:this.Users.filter(s=>s.group==="mods"),subs:this.Users.filter(s=>s.group==="subs"),vips:this.Users.filter(s=>s.group==="vips"),viewers:this.Users.filter(s=>s.group==="viewers")}}},data(){return{tiersList:[{name:"A",color:"rgb(213 76 76)",users:[]},{name:"B",color:"rgb(215 148 81)",users:[]},{name:"C",color:"rgb(255, 223, 127)",users:[]},{name:"D",color:"#d7d74c",users:[]},{name:"F",color:"rgb(147 215 79)",users:[]}],allUsers:[],Users:[],channel:this.$route.query.channel,maxPlayers:100}},methods:{getMaxPlayers(){let s=this.$route.query.maxplayers;s!=null&&(s=parseInt(s),s<5?this.maxPlayers=5:s>500?this.maxPlayers=500:this.maxPlayers=s)},startDrag(s,t){s.dataTransfer.dropEffect="move",s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("group",t.group),s.dataTransfer.setData("nick",t.nick)},onDrop(s,t){s.dataTransfer.getData("group");const a=s.dataTransfer.getData("nick"),h=this.Users.find(u=>u.nick==a);h.group=t},connect:function(){console.log("Connecting to twitch.."),this.connection=new WebSocket("wss://irc-ws.chat.twitch.tv:443"),this.connection.onopen=s=>{this.connection.send("NICK justinfan1337"),this.connection.send("JOIN #"+this.channel),this.connection.send("CAP REQ :twitch.tv/tags twitch.tv/commands")},this.connection.onclose=s=>{console.log("Reconnecting.."),setTimeout(function(){this.connect()},5e3)},this.connection.onmessage=s=>{let t=s.data.toString().split(`
`);const a=/^(?:@([^ ]+) )?(?:[:](\S+) )?(\S+)(?: (?!:)(.+?))?(?: [:](.+))?$/,h=/([^=;]+)=([^;]*)/g,u=/([^,]+)\/([^,]*)/g,r=/([^\/]+):([^\/]*)/g,o=/([^,]+)-([^,]*)/g,c=/^\u0001ACTION (.*)\u0001$/g,n=/([a-z_0-9]+)!([a-z_0-9]+)@([a-z._0-9]+)/;let e={tags:{},command:!1,message:"",raw:t[f]};for(var f=0;f<t.length;f++){if(t[f].length==0)return;const p=a.exec(t[f].trim());if(p===null){console.error(`Couldnt parse message '${t[f]}'`);return}let N=p[1]?p[1]:!1;if(N){let b;do if(b=h.exec(N),b){const[,d,w]=b;switch(d){case"badges":case"badge-info":e.tags[d]={};let v;do if(v=u.exec(w),v){const[,m,C]=v;e.tags[d][m]=C}while(v);break;case"emotes":e.tags[d]={};let y;do if(y=r.exec(w),y){const[,m,C]=y;let k;do if(k=o.exec(C),k){const[,A,S]=k;e.tags[d][m]||(e.tags[d][m]=new Array),e.tags[d][m].push({startIndex:A,endIndex:S})}while(k)}while(y);break;default:e.tags[d]=w.replace(/\\s/g," ").trim()}}while(b)}let R=n.exec(p[2]);e.user=!1,R!=null&&(e.user=R[1]),e.command=p[3],e.room=p[4],e.message=p[5],e.action=!1;const O=c.exec(e.message);O!=null&&(e.action=!0,e.message=O[1]);break}switch(e.command){case"PONG":console.log("Pong"),pinger.gotPong();break;case"PING":this.connection.send("PONG :"+e.message);break;case"JOIN":console.log("Joined",e.room);break;case"PRIVMSG":!this.allUsers.includes(e.user)&&this.allUsers.length+1<=this.maxPlayers&&e.message.split(" ",2)[0]=="!add"&&(this.allUsers.push(e.user),Object.keys(e.tags.badges).includes("moderator")?this.Users.push({nick:e.user,color:e.tags.color,group:"mods",groupColor:"rgb(48 155 41)"}):Object.keys(e.tags.badges).includes("vip")?this.Users.push({nick:e.user,color:e.tags.color,group:"vips",groupColor:"rgb(180 35 183)"}):Object.keys(e.tags.badges).includes("subscriber")?this.Users.push({nick:e.user,color:e.tags.color,group:"subs",groupColor:"#7851a9"}):this.Users.push({nick:e.user,color:e.tags.color,group:"viewers",groupColor:"rgb(24 87 171)"}));break}}}},name:"Play",props:["maxplayers"],beforeMount(){this.getMaxPlayers(),this.connect()},components:{userList:E,tierList:Q}},H={id:"game"},X=g("div",{id:"title"}," \u0412\u0432\u0435\u0434\u0438\u0442\u0435 !add \u0432 \u0447\u0430\u0442 \u0447\u0442\u043E\u0431\u044B \u0434\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0441\u0435\u0431\u044F \u0432 \u0441\u043F\u0438\u0441\u043E\u043A. ",-1);function Y(s,t,a,h,u,r){const o=U("tierList"),c=U("userList"),n=U("center");return i(),l("div",H,[X,_(n,null,{default:j(()=>[_(o,{tiers:u.tiersList,groups:r.groups,startDrag:r.startDrag,onDrop:r.onDrop},null,8,["tiers","groups","startDrag","onDrop"]),_(c,{id:"viewers",users:r.groups.viewers,startDrag:r.startDrag,onDrop:r.onDrop,desc:"\u0417\u0440\u0438\u0442\u0435\u043B\u0438",descColor:"rgb(24 87 171)"},null,8,["users","startDrag","onDrop"]),_(c,{id:"subs",users:r.groups.subs,startDrag:r.startDrag,onDrop:r.onDrop,desc:"\u041F\u043E\u0434\u043F\u0438\u0441\u0447\u0438\u043A\u0438",descColor:"#7851a9"},null,8,["users","startDrag","onDrop"]),_(c,{id:"vips",users:r.groups.vips,startDrag:r.startDrag,onDrop:r.onDrop,desc:"\u0412\u0438\u043F\u044B",descColor:"rgb(180 35 183)"},null,8,["users","startDrag","onDrop"]),_(c,{id:"mods",users:r.groups.mods,startDrag:r.startDrag,onDrop:r.onDrop,desc:"\u041C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440\u044B",descColor:"rgb(48 155 41)"},null,8,["users","startDrag","onDrop"])]),_:1})])}var ss=I(W,[["render",Y]]);export{ss as default};
